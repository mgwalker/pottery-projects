name: content modified

on:
  push:
    paths-ignore:
      - 'docs/**'

jobs:
  rebuild:
    name: rebuild the site
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: 18

      - name: install dependencies
        run: npm ci

      - name: build the index page
        run: npx @11ty/eleventy

      - run: if git diff --exit-code --quiet; then echo "::set-output name=changes::no"; else echo "::set-output name=changes::yes"; fi
        id: diff
        name: check if anything actually changed

      - if: steps.diff.outputs.changes == 'yes'
        uses: EndBug/add-and-commit@v9
        with:
          message: automated rebuild happened here
